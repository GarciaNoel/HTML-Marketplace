<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>HTML Marketplace</title>
  <style>
    #tabs { display: flex; border-bottom: 1px solid #ccc; }
    .tab { padding: 8px 16px; cursor: pointer; border: 1px solid #ccc; border-bottom: none; background: #eee; }
    .tab.active { background: #fff; font-weight: bold; }
    #tab-contents > div { display: none; padding: 10px; }
    #tab-contents > div.active { display: block; }
    .tab-content { width: 100%; min-height: 400px; }
  </style>
</head>
<body>
  <div id="tabs"></div>
  <div id="tab-contents"></div>
  <script>
    window.electronAPI.onDefaultPages(pages => {
      pages.forEach(page => addTab(page.name, page.content));
    });

    const tabs = document.getElementById('tabs')
    const tabContents = document.getElementById('tab-contents')

    let tabData = []

    function addTab(name, content) {
      const idx = tabData.length
      tabData.push({ name, content })

      const tab = document.createElement('div')
      tab.className = 'tab'
      tab.textContent = name
      tab.onclick = () => setActiveTab(idx)
      tabs.appendChild(tab)

      const contentDiv = document.createElement('div')
      contentDiv.className = 'tab-content'
      contentDiv.innerHTML = content
      tabContents.appendChild(contentDiv)

      executeScripts(contentDiv);

      setActiveTab(idx)
    }

    function executeScripts(container) {
      const scripts = container.querySelectorAll('script');
      scripts.forEach(oldScript => {
        const newScript = document.createElement('script');
        for (const attr of oldScript.attributes) {
          newScript.setAttribute(attr.name, attr.value);
        }
        newScript.text = oldScript.text;
        oldScript.parentNode.replaceChild(newScript, oldScript);
      });
    }

    function setActiveTab(idx) {
      Array.from(tabs.children).forEach((tab, i) => tab.classList.toggle('active', i === idx));
      Array.from(tabContents.children).forEach((div, i) => div.classList.toggle('active', i === idx));
    }

    window.electronAPI.onAddTab(({ name, content }) => {
      addTab(name, content);
    });
  </script>
</body>
</html>